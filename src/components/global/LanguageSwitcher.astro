---
import { languages, defaultLang, showDefaultLang } from "../../i18n/ui";
import { getLangFromUrl, getLocalizedPathname } from "../../i18n/utils";

const currentLang = getLangFromUrl(Astro.url);
const currentPath = Astro.url.pathname;
---

<div class="relative inline-block" x-data="{ open: false }">
  <button
    id="lang-switcher-btn"
    class="flex items-center gap-1.5 px-3 py-1.5 text-sm border border-light-border dark:border-dark-border rounded-lg hover:border-accent-500 dark:hover:border-accent-500 transition-colors"
    aria-label="Change language"
  >
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"
      />
    </svg>
    <span class="uppercase font-medium">{currentLang}</span>
    <svg class="w-3 h-3 transition-transform" id="lang-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
    </svg>
  </button>

  <div
    id="lang-dropdown"
    class="hidden absolute right-0 mt-2 py-1 w-32 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg shadow-lg z-50"
  >
    {
      Object.entries(languages).map(([lang, label]) => (
        <a
          href={getLocalizedPathname(currentPath, lang as keyof typeof languages)}
          class:list={[
            "block px-4 py-2 text-sm hover:bg-light-border/50 dark:hover:bg-dark-border/50 transition-colors",
            currentLang === lang
              ? "text-accent-500 font-medium"
              : "text-light-text dark:text-dark-text",
          ]}
        >
          {label}
        </a>
      ))
    }
  </div>
</div>

<script>
  const btn = document.getElementById("lang-switcher-btn");
  const dropdown = document.getElementById("lang-dropdown");
  const arrow = document.getElementById("lang-arrow");

  if (btn && dropdown && arrow) {
    btn.addEventListener("click", (e) => {
      e.stopPropagation();
      dropdown.classList.toggle("hidden");
      arrow.classList.toggle("rotate-180");
    });

    document.addEventListener("click", () => {
      dropdown.classList.add("hidden");
      arrow.classList.remove("rotate-180");
    });
  }
</script>
